# PATCH FOR: setup_wizard.py
# Key changes: Remove AetherMUD references, fix model deduplication, add path handling

LOCATION: Lines 87-95 (get_installed_models method)

OLD:
```python
def get_installed_models(self) -> List[str]:
    """
    Get list of installed Ollama models.
    Returns: List of model names
    """
    try:
        response = requests.get(f"{self.ollama_host}/api/tags", timeout=3)
        if response.status_code == 200:
            data = response.json()
            return [model['name'] for model in data.get('models', [])]
        return []
    except Exception:
        return []
```

NEW:
```python
def get_installed_models(self) -> List[str]:
    """
    Get list of installed Ollama models.
    Returns: Deduplicated list of model names
    """
    try:
        response = requests.get(f"{self.ollama_host}/api/tags", timeout=3)
        if response.status_code == 200:
            data = response.json()
            models = [model['name'] for model in data.get('models', [])]
            # Deduplicate while preserving order
            return list(dict.fromkeys(models))
        return []
    except Exception:
        return []
```

---

LOCATION: Lines 145-165 (create_config method signature and implementation)

OLD:
```python
def create_config(
    self,
    app_name: str,
    knowledge_base_path: str,
    selected_model: str
) -> Tuple[bool, str]:
    """
    Create config.yaml from user inputs.
    Returns: (success, message)
    """
    try:
```

NEW:
```python
def create_config(
    self,
    app_name: str,
    selected_model: str,
    ollama_models_path: str = None,
    database_path: str = None,
    install_dir: str = None,
    codebase_path: str = None
) -> Tuple[bool, str]:
    """
    Create config.yaml from user inputs.
    Returns: (success, message)
    """
    try:
```

ADD after the try statement (before config creation):
```python
        # Use defaults for Windows if not provided
        if not ollama_models_path:
            from pathlib import Path
            home = str(Path.home())
            ollama_models_path = f"{home}\\.ollama\\models"
        
        if not database_path:
            database_path = "./chroma_db"
        
        if not install_dir:
            install_dir = str(self.script_dir)
```

Then add to the config dictionary (around line ~170):
```python
        config = {
            'assistant': {
                'name': app_name,
                'version': '1.0.0'
            },
            'models': {
                'default': selected_model,
                'balanced': selected_model,
                'fast': 'qwen2.5-coder:1.5b'
            },
            'paths': {
                'ollama_models': ollama_models_path,
                'database': database_path,
                'install_dir': install_dir,
                'codebase': codebase_path
            },
            'context': {
                'max_lines_per_file': 300,
                'context_window': 16384
            },
            'ollama': {
                'host': 'http://localhost:11434',
                'timeout': 60
            },
            'indexing': {
                'collection_name': 'universal_knowledge',
                'sync_on_start': True
            }
        }
```

---

LOCATION: Add new method to SetupWizardBackend class (after mark_setup_complete method, around line ~75)

ADD THIS NEW METHOD:
```python
def resolve_paths(self, config: Dict) -> Dict:
    """
    Resolve configuration paths, filling in defaults where needed.
    Returns: config dict with all paths resolved
    """
    from pathlib import Path
    home = str(Path.home())
    
    # Ollama models path
    if not config['paths'].get('ollama_models'):
        config['paths']['ollama_models'] = f"{home}\\.ollama\\models"
    
    # Database path
    if not config['paths'].get('database'):
        config['paths']['database'] = "./chroma_db"
    
    # Install directory
    if not config['paths'].get('install_dir'):
        config['paths']['install_dir'] = str(self.script_dir)
    
    return config
```
